openapi: 3.1.0
info:
  title: Restock AI API
  description: >-
    Dokumentasi API untuk Agen Stok AI (Smart UMKM). 
    CATATAN: Spesifikasi ini mencerminkan implementasi AKTUAL di lapangan 
    dan menggantikan Blueprint PDF awal.
  version: 1.0.0
servers:
  - url: 'https://dutzgkygmvwmpqgddddn.supabase.co/functions/v1'
    description: Server Produksi (Supabase Edge Functions)
  - url: 'http://localhost:8000'
    description: Server Pengembangan Lokal
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
security:
  - bearerAuth: []
paths:
  /parse-receipt:
    post:
      summary: Pindai Gambar Struk (OCR)
      description: >-
        Mengekstrak daftar belanjaan dari gambar fisik struk menggunakan Gemini Vision.
      security: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
                  description: File gambar struk (jpg/png, maks 4MB).
      responses:
        '200':
          description: Ekstraksi Berhasil
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      supplier_name:
                        type: string
                        nullable: true
                        description: Nama toko/supplier yang terdeteksi.
                        example: Indomaret
                      transaction_date:
                        type: string
                        format: date
                        nullable: true
                        description: Tanggal transaksi terdeteksi.
                        example: '2024-01-25'
                      items:
                        type: array
                        description: Daftar barang yang dibeli.
                        items:
                          type: object
                          properties:
                            name:
                              type: string
                              example: Minyak Goreng
                            qty:
                              type: integer
                              example: 2
                            price:
                              type: integer
                              example: 35000
                      summary_text:
                        type: string
                        description: Ringkasan singkat hasil pembacaan AI.
                        example: Belanja 2 item di Indomaret.
  /analyze-stock-health:
    post:
      summary: Analisa Kesehatan Stok (Agen AI)
      description: >-
        Memeriksa inventaris pengguna di database. Mengembalikan status 'WARNING' 
        dan pesan peringatan dari AI jika stok menipis (burn rate tinggi).
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Hasil Analisa
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    enum:
                      - SAFE
                      - WARNING
                    example: WARNING
                  agent_message:
                    type: string
                    description: Pesan mendesak dari AI (Bahasa Indonesia).
                    example: 'Bos, gawat! Minyak goreng mau habis besok!'
                  alerts:
                    type: array
                    description: Daftar barang yang kritis.
                    items:
                      type: object
                      properties:
                        name:
                          type: string
                          example: Minyak Goreng
                        sisa:
                          type: number
                          example: 2
                        habis_dalam:
                          type: number
                          description: Estimasi sisa hari sebelum stok habis total.
                          example: 1.5
  /generate-order-text:
    post:
      summary: Buat Draft Pesan WhatsApp
      description: >-
        Membuat teks chat bahasa alami untuk pemesanan barang ke supplier via WhatsApp.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - items
              properties:
                supplier_name:
                  type: string
                  example: Ko Hendra
                items:
                  type: array
                  items:
                    type: object
                    properties:
                      name:
                        type: string
                        example: Beras Pandan Wangi
                      qty:
                        type: string
                        description: 'Mendukung satuan teks (contoh: "1 kardus" atau "10 kg")'
                        example: 1 kardus
      responses:
        '200':
          description: Teks Tergenerasi
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: 'Halo Ko Hendra, mau order Minyak Goreng 1 kardus ya.'